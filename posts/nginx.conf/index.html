<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="nginx配置文件 nginx.conf" /><meta name="author" content="voidblank" /><meta property="og:locale" content="en_US" /><meta name="description" content="nginx配置文件 nginx.conf 默认目录: windows:nginx/conf/nginx.conf linux:nginx/nginx.conf 修改配置文件后需要进行nginx -s reload操作 检查配置文件是否无误:nginx -t 顺序依旧是按照从上到下的顺序说明" /><meta property="og:description" content="nginx配置文件 nginx.conf 默认目录: windows:nginx/conf/nginx.conf linux:nginx/nginx.conf 修改配置文件后需要进行nginx -s reload操作 检查配置文件是否无误:nginx -t 顺序依旧是按照从上到下的顺序说明" /><link rel="canonical" href="https://voidblank.github.io/posts/nginx.conf/" /><meta property="og:url" content="https://voidblank.github.io/posts/nginx.conf/" /><meta property="og:site_name" content="voidblank" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-05-23T11:55:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="nginx配置文件 nginx.conf" /><meta name="twitter:site" content="@voidblank" /><meta name="twitter:creator" content="@voidblank" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"voidblank"},"description":"nginx配置文件 nginx.conf 默认目录: windows:nginx/conf/nginx.conf linux:nginx/nginx.conf 修改配置文件后需要进行nginx -s reload操作 检查配置文件是否无误:nginx -t 顺序依旧是按照从上到下的顺序说明","headline":"nginx配置文件 nginx.conf","dateModified":"2021-05-23T11:55:00+08:00","url":"https://voidblank.github.io/posts/nginx.conf/","datePublished":"2021-05-23T11:55:00+08:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://voidblank.github.io/posts/nginx.conf/"},"@context":"https://schema.org"}</script><title>nginx配置文件 nginx.conf | voidblank</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://imgur.com/oEa1xeJ.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">voidblank</a></div><div class="site-subtitle font-italic">just a blog!</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/voidblank" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/voidblank" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['cy1245171920','outlook.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>nginx配置文件 nginx.conf</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>nginx配置文件 nginx.conf</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> voidblank </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, May 23, 2021, 11:55 AM +0800" prep="on" > May 23 <i class="unloaded">2021-05-23T11:55:00+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1573 words">8 min</span></div></div><div class="post-content"><h1 id="nginx配置文件-nginxconf">nginx配置文件 nginx.conf</h1><ul><li>默认目录:<ul><li>windows:<code class="language-plaintext highlighter-rouge">nginx/conf/nginx.conf</code><li>linux:<code class="language-plaintext highlighter-rouge">nginx/nginx.conf</code></ul><li>修改配置文件后需要进行<code class="language-plaintext highlighter-rouge">nginx -s reload</code>操作<li>检查配置文件是否无误:<code class="language-plaintext highlighter-rouge">nginx -t</code><li>顺序依旧是按照从上到下的顺序说明</ul><div class="language-conf highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
</pre><td class="rouge-code"><pre><span class="c">#指明nginx的用户及用户组
#windows下不指定
</span><span class="n">user</span>  <span class="n">www</span> <span class="n">www</span>;

<span class="c">#nginx的worker进程数量,根据硬件进行调整,一般为CPU数量或2倍数量
</span><span class="n">worker_processes</span>  <span class="m">2</span>;

<span class="c">#指定进程可以打开的最大描述符,值应与 /etc/security/limits.conf一致
</span><span class="n">worker_rlimit_nofile</span> <span class="m">65535</span>;

<span class="c">#pid文件存放路径
</span><span class="n">pid</span> /<span class="n">var</span>/<span class="n">run</span>/<span class="n">nginx</span>.<span class="n">pid</span>;

<span class="c">#设定错误日志的文件位置及级别,可多个
#级别: debug &gt; info &gt; notice &gt; warn &gt; error &gt; crit 
#级别越高,显示的内容越多
#error_log  /var/log/nginx.error_log  info;
</span>
<span class="n">events</span> {
    <span class="c">#单个worker进程的最大连接数
</span>    <span class="c">#nginx的总连接数=worker_processes * worker_connections
</span>    <span class="n">worker_connections</span>   <span class="m">2000</span>;

    <span class="c">#设置模型,可选项:kqueue, epoll, /dev/poll, select, poll
</span>    <span class="c">#FreeBSD使用kqueue, linux使用epoll
</span>    <span class="n">use</span> <span class="n">kqueue</span>;

    <span class="c">#设置worker的工作方式为并行
</span>    <span class="n">multi_accept</span> <span class="n">on</span>;
}

<span class="n">http</span> {
    <span class="c">#加载MIME type映射
</span>    <span class="n">include</span>       <span class="n">conf</span>/<span class="n">mime</span>.<span class="n">types</span>;

    <span class="c">#默认的文件类型
</span>    <span class="n">default_type</span>  <span class="n">application</span>/<span class="n">octet</span>-<span class="n">stream</span>;

    <span class="c">#隐藏nginx版本号
</span>    <span class="n">server_tokens</span> <span class="n">off</span>;

    <span class="c"># 设定日志格式 可以设置多种样式,如下的main|download
</span>    <span class="c">#1.$remote_addr 与$http_x_forwarded_for 用以记录客户端的ip地址
</span>    <span class="c">#2.$remote_user: 用来记录客户端用户名称
</span>    <span class="c">#3.$time_local: 用来记录访问时间与时区
</span>    <span class="c">#4.$request: 用来记录请求的url与http协议
</span>    <span class="c">#5.$status: 用来记录请求状态；
</span>    <span class="c">#6.$body_bytes_sent: 记录发送给客户端文件主体内容大小
</span>    <span class="c">#7.$http_referer: 用来记录从那个页面链接访问过来的
</span>    <span class="n">log_format</span> <span class="n">main</span>      <span class="s1">'$remote_addr - $remote_user [$time_local] '</span>
                         <span class="s1">'"$request" $status $bytes_sent '</span>
                         <span class="s1">'"$http_referer" "$http_user_agent" '</span>
                         <span class="s1">'"$gzip_ratio"'</span>;

    <span class="n">log_format</span> <span class="n">download</span>  <span class="s1">'$remote_addr - $remote_user [$time_local] '</span>
                         <span class="s1">'"$request" $status $bytes_sent '</span>
                         <span class="s1">'"$http_referer" "$http_user_agent" '</span>
                         <span class="s1">'"$http_range" "$sent_http_content_range"'</span>;
    <span class="c">#设置连接日志
</span>    <span class="n">access_log</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">nginx</span>.<span class="n">access</span>.<span class="n">log</span> <span class="n">main</span>;
    <span class="c">#关闭连接日志
</span>    <span class="c">#access_log off;
</span>    <span class="c">#设置错误日志
</span>    <span class="n">error_log</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">nginx</span>.<span class="n">error</span>.<span class="n">log</span>;

    <span class="c">#读取header超时时间 3minutes
</span>    <span class="n">client_header_timeout</span>  <span class="m">3</span><span class="n">m</span>;
    <span class="c">#读取body超时时间 3minutes
</span>    <span class="n">client_body_timeout</span>    <span class="m">3</span><span class="n">m</span>;
    <span class="c">#响应客户端超时时间 3minutes
</span>    <span class="n">send_timeout</span>           <span class="m">3</span><span class="n">m</span>;

    <span class="c">#客户端header的buffer大小
</span>    <span class="n">client_header_buffer_size</span>    <span class="m">1</span><span class="n">k</span>;
    <span class="c">#客户端header的buffer的最大数量及大小
</span>    <span class="n">large_client_header_buffers</span>  <span class="m">4</span> <span class="m">4</span><span class="n">k</span>;

    <span class="c">#启用gzip压缩
</span>    <span class="n">gzip</span> <span class="n">on</span>;
    <span class="c">#最小压缩文件大小
</span>    <span class="n">gzip_min_length</span>  <span class="m">1100</span>;
    <span class="c">#压缩缓冲区
</span>    <span class="n">gzip_buffers</span>     <span class="m">4</span> <span class="m">8</span><span class="n">k</span>;
    <span class="c">#压缩类型
</span>    <span class="n">gzip_types</span>       <span class="n">text</span>/<span class="n">plain</span>;

    <span class="n">output_buffers</span>   <span class="m">1</span> <span class="m">32</span><span class="n">k</span>;
    <span class="n">postpone_output</span>  <span class="m">1460</span>;

    <span class="c">#指定nginx是否使用零拷贝来输出文件
</span>    <span class="c">#仅在高IO时才设为off
</span>    <span class="n">sendfile</span>         <span class="n">on</span>;
    <span class="c">#禁用socket的TCP_CORK,仅在sendfile时使用
</span>    <span class="n">tcp_nopush</span>       <span class="n">on</span>;
    <span class="n">tcp_nodelay</span>      <span class="n">on</span>;
    <span class="n">send_lowat</span>       <span class="m">12000</span>;

    <span class="c">#keep-alive超时时间,参数一为时间(秒),参数二为HTTP headers中展示的值
</span>    <span class="c">#如果想要关闭,则设置时间为0即可
</span>    <span class="n">keepalive_timeout</span>  <span class="m">75</span> <span class="m">20</span>;

    <span class="c">#lingering_time     30;
</span>    <span class="c">#lingering_timeout  10;
</span>    <span class="c">#reset_timedout_connection  on;
</span>

    <span class="n">server</span> {
        <span class="c">#设置监听端口
</span>        <span class="n">listen</span>        <span class="m">80</span>;
        <span class="c">#设置访问域名
</span>        <span class="n">server_name</span>   <span class="n">one</span>.<span class="n">example</span>.<span class="n">com</span>  <span class="n">www</span>.<span class="n">one</span>.<span class="n">example</span>.<span class="n">com</span>;

        <span class="c">#server的日志
</span>        <span class="n">access_log</span>   /<span class="n">var</span>/<span class="n">log</span>/<span class="n">nginx</span>.<span class="n">access_log</span>  <span class="n">main</span>;

        <span class="c">#对于前后端分离的项目来说,设置前端静态路径及首页
</span>        <span class="c">#静态资源设置也可以在location中设定,见下
</span>        <span class="c">#index默认为: index index.html;
</span>        <span class="n">root</span> /<span class="n">usr</span>/<span class="n">demo</span>/<span class="n">dict</span>;
        <span class="n">index</span> <span class="n">index</span>.<span class="n">html</span> <span class="n">index</span>.<span class="n">htm</span>;

        <span class="c">#匹配: one.example.com/*
</span>        <span class="n">location</span> / {
            <span class="c">#访问该路径时,代理到该URL
</span>            <span class="n">proxy_pass</span>         <span class="n">http</span>://<span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>/;
            <span class="c">#设置代理后重定向与否
</span>            <span class="c">#proxy_redirect     off;
</span>
            <span class="c">#将代理服务器接受到的信息传到真实服务器上
</span>            <span class="n">proxy_set_header</span>   <span class="n">Host</span>             $<span class="n">host</span>;
            <span class="n">proxy_set_header</span>   <span class="n">X</span>-<span class="n">Real</span>-<span class="n">IP</span>        $<span class="n">remote_addr</span>;
            <span class="n">proxy_set_header</span>  <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">For</span> $<span class="n">proxy_add_x_forwarded_for</span>;
            <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">Proto</span> $<span class="n">scheme</span>;

            <span class="c">#设定通过nginx上传文件的大小 10mb
</span>            <span class="n">client_max_body_size</span>       <span class="m">10</span><span class="n">m</span>;
            <span class="c">#设置body缓冲区的大小,超过这个大小的文件可能会返回500错误
</span>            <span class="n">client_body_buffer_size</span>    <span class="m">128</span><span class="n">k</span>;

            <span class="c">#设置文件上传的记录目录,最多可以设置三层
</span>            <span class="c">#client_body_temp_path path level1 level2 level3
</span>            <span class="c">#level参数如果有,表示有这一级目录,值表示数字位数
</span>            <span class="n">client_body_temp_path</span>      /<span class="n">var</span>/<span class="n">nginx</span>/<span class="n">client_body_temp</span>;

            <span class="c">#后台连接超时时间
</span>            <span class="n">proxy_connect_timeout</span>      <span class="m">70</span>;
            <span class="c">#后台回传超时时间
</span>            <span class="n">proxy_send_timeout</span>         <span class="m">90</span>;
            <span class="c">#后台响应超时时间
</span>            <span class="n">proxy_read_timeout</span>         <span class="m">90</span>;
            <span class="n">proxy_send_lowat</span>           <span class="m">12000</span>;

            <span class="c">#代理读取的第一部分(headers)缓冲区大小
</span>            <span class="n">proxy_buffer_size</span>          <span class="m">4</span><span class="n">k</span>;
            <span class="c">#代理读取的缓冲区个数与大小
</span>            <span class="n">proxy_buffers</span>              <span class="m">4</span> <span class="m">32</span><span class="n">k</span>;
            <span class="c">#高负荷下缓冲区大小,应为proxy_buffers * 2
</span>            <span class="n">proxy_busy_buffers_size</span>    <span class="m">64</span><span class="n">k</span>;
            <span class="c">#设定缓存文件大小
</span>            <span class="n">proxy_temp_file_write_size</span> <span class="m">64</span><span class="n">k</span>;
            <span class="c">#设定缓存文件路径
</span>            <span class="n">proxy_temp_path</span>            /<span class="n">var</span>/<span class="n">nginx</span>/<span class="n">proxy_temp</span>;
            <span class="c">#设置字符集
</span>            <span class="n">charset</span>  <span class="n">koi8</span>-<span class="n">r</span>;
        }

        <span class="c"># 设置error page
</span>        <span class="n">error_page</span>  <span class="m">404</span>  /<span class="m">404</span>.<span class="n">html</span>;

        <span class="c">#匹配: one.example.com/404.html
</span>        <span class="n">location</span> = /<span class="m">404</span>.<span class="n">html</span> {
            <span class="n">root</span>  /<span class="n">spool</span>/<span class="n">www</span>;
        }

        <span class="c">#匹配: one.example.com/old_stuff/*
</span>        <span class="n">location</span> /<span class="n">old_stuff</span>/ {
            <span class="c">#url重写
</span>            <span class="c">#permanent表示永久重定向,即301
</span>            <span class="c">#redirect表示临时重定向,即302
</span>            <span class="n">rewrite</span>   ^/<span class="n">old_stuff</span>/(.*)$  /<span class="n">new_stuff</span>/$<span class="m">1</span>  <span class="n">permanent</span>;
        }

        <span class="c">#匹配: /*/*.jpg /*/*.jpeg /*/*.gif 不区分大小写
</span>        <span class="n">location</span> ~* \.(<span class="n">jpg</span>|<span class="n">jpeg</span>|<span class="n">gif</span>)$ {
            <span class="n">root</span>         /<span class="n">spool</span>/<span class="n">www</span>;
            <span class="n">access_log</span>   <span class="n">off</span>;
            <span class="c">#文件过期时间控制,30 days
</span>            <span class="n">expires</span>      <span class="m">30</span><span class="n">d</span>;
        }
    }
}
</pre></table></code></div></div><h2 id="location匹配规则">location匹配规则</h2><ul><li>匹配原则从上到下:<li><code class="language-plaintext highlighter-rouge">=</code>(精确匹配)<li><code class="language-plaintext highlighter-rouge">^~</code>(以xx开头的匹配)<li><code class="language-plaintext highlighter-rouge">~\.()$</code>(正则匹配)<li><code class="language-plaintext highlighter-rouge">/</code>(通用匹配)<li>注:相同匹配级别中,按匹配长度排序,如:<ul><li><code class="language-plaintext highlighter-rouge">/123/456</code>匹配<code class="language-plaintext highlighter-rouge">/</code>与<code class="language-plaintext highlighter-rouge">/123</code>,则会按<code class="language-plaintext highlighter-rouge">/123</code>处理请求</ul></ul><h3 id="可用的几种匹配规则">可用的几种匹配规则</h3><ul><li><code class="language-plaintext highlighter-rouge">location /</code>:全匹配<li><code class="language-plaintext highlighter-rouge">location = /404.html</code>:匹配<code class="language-plaintext highlighter-rouge">/404.html</code><li><code class="language-plaintext highlighter-rouge">location ^~/123/</code>:匹配<code class="language-plaintext highlighter-rouge">/123/*</code><li><code class="language-plaintext highlighter-rouge">location ~/atX/</code>:匹配<code class="language-plaintext highlighter-rouge">/atX/*</code><li><code class="language-plaintext highlighter-rouge">location ~*/atX/</code>:匹配<code class="language-plaintext highlighter-rouge">/atX/*</code>(不区分大小写)<li><code class="language-plaintext highlighter-rouge">location !~/atX/</code>:不匹配<code class="language-plaintext highlighter-rouge">!~/atX/*</code><li><code class="language-plaintext highlighter-rouge">location ~*\.(png|jpg|gif|bmp|jpeg|webp)$</code>:匹配以这几个为结尾的url,不区分大小写</ul><h2 id="附1">附1</h2><ul><li>Vue前端打包后可参考的linux配置</ul><div class="language-conf highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="n">user</span>  <span class="n">root</span>;
<span class="n">worker_processes</span>  <span class="m">1</span>;
<span class="n">include</span> /<span class="n">usr</span>/<span class="n">share</span>/<span class="n">nginx</span>/<span class="n">modules</span>/<span class="n">mod</span>-<span class="n">stream</span>.<span class="n">conf</span>;

<span class="n">events</span> {
    <span class="n">worker_connections</span>  <span class="m">2048</span>;
    <span class="n">multi_accept</span> <span class="n">on</span>;
    <span class="n">use</span> <span class="n">epoll</span>;
}


<span class="n">http</span> {
    <span class="n">include</span> <span class="n">mime</span>.<span class="n">types</span>;
    <span class="n">default_type</span> <span class="n">application</span>/<span class="n">octet</span>-<span class="n">stream</span>;
    <span class="n">sendfile</span> <span class="n">on</span>;
    <span class="n">keepalive_timeout</span> <span class="m">65</span>;
    <span class="n">access_log</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">nginx</span>.<span class="n">access</span>.<span class="n">log</span>;
    <span class="n">error_log</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">nginx</span>.<span class="n">error</span>.<span class="n">log</span>;
}

<span class="n">server</span> {
    <span class="n">listen</span> <span class="m">80</span>;
    <span class="n">server_name</span> <span class="m">192</span>.<span class="m">168</span>.<span class="m">0</span>.<span class="m">1</span>:<span class="m">80</span>;
    <span class="n">root</span> /<span class="n">usr</span>/<span class="n">html</span>/<span class="n">demo</span>/<span class="n">dict</span>;

    <span class="n">location</span> / {
        <span class="n">try_files</span> $<span class="n">uri</span> $<span class="n">uri</span>/ /<span class="n">index</span>.<span class="n">html</span>;
    }

    <span class="n">location</span> ^~ /<span class="n">api</span> {
        <span class="n">proxy_set_header</span> <span class="n">Host</span> $<span class="n">host</span>;
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Real_IP</span> $<span class="n">remote_addr</span>;
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded_For</span> $<span class="n">proxy_add_x_forwarded_for</span>;
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">Proto</span> $<span class="n">scheme</span>;
        <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="m">192</span>.<span class="m">168</span>.<span class="m">0</span>.<span class="m">2</span>:<span class="m">8080</span>/;
    }
}
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/nginx/'>nginx</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/nginx/" class="post-tag no-text-decoration" >nginx</a> <a href="/tags/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" class="post-tag no-text-decoration" >配置文件</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=nginx配置文件 nginx.conf - voidblank&url=https://voidblank.github.io/posts/nginx.conf/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=nginx配置文件 nginx.conf - voidblank&u=https://voidblank.github.io/posts/nginx.conf/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=nginx配置文件 nginx.conf - voidblank&url=https://voidblank.github.io/posts/nginx.conf/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/vuex/">Vuex</a><li><a href="/posts/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a><li><a href="/posts/spring-boot-%E6%B3%A8%E8%A7%A3/">SpringBoot 注解</a><li><a href="/posts/enable-google-pv/">Enable Google Page Views</a><li><a href="/posts/abstract-queued-synchronizer/">AQS</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a> <a class="post-tag" href="/tags/%E5%9F%BA%E7%A1%80/">基础</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/java%E6%BA%90%E7%A0%81/">java源码</a> <a class="post-tag" href="/tags/jdk1-8/">JDK1.8</a> <a class="post-tag" href="/tags/%E5%90%8E%E5%8F%B0/">后台</a> <a class="post-tag" href="/tags/vue/">vue</a> <a class="post-tag" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">多线程</a> <a class="post-tag" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a> <a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95/">算法</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/server.xml/"><div class="card-body"> <span class="timeago small" > May 23 <i class="unloaded">2021-05-23T11:55:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>tomcat配置文件 server.xml</h3><div class="text-muted small"><p> tomcat配置文件 server.xml 默认目录:$TOMCAT_HOME/conf/server.xml 文件为静态资源类型,修改后需要重启tomcat才能生效 注:标签的顺序根据在配置文件中出现的顺序排列 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 ...</p></div></div></a></div><div class="card"> <a href="/posts/mysql-basic/"><div class="card-body"> <span class="timeago small" > May 30 <i class="unloaded">2021-05-30T21:57:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MySQL 基础</h3><div class="text-muted small"><p> MySQL 基础 DQL Data Query Language,数据查询语言 语句 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 -- 一 SELECT st_id AS id, st_name AS NAME FROM test_table1 t1, te...</p></div></div></a></div><div class="card"> <a href="/posts/abstract-queued-synchronizer/"><div class="card-body"> <span class="timeago small" > May 23 <i class="unloaded">2021-05-23T13:32:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AQS</h3><div class="text-muted small"><p> AbstractQueuedSynchronizer public abstract class AbstractQueuedSynchronizer extends AbstractOwnableSynchronizer implements java.io.Serializable AQS 成员变量 head private transient volatile N...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/spring-boot-%E6%B3%A8%E8%A7%A3/" class="btn btn-outline-primary" prompt="Older"><p>SpringBoot 注解</p></a> <a href="/posts/server.xml/" class="btn btn-outline-primary" prompt="Newer"><p>tomcat配置文件 server.xml</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/username">voidblank</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a> <a class="post-tag" href="/tags/%E5%9F%BA%E7%A1%80/">基础</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/java%E6%BA%90%E7%A0%81/">java源码</a> <a class="post-tag" href="/tags/jdk1-8/">JDK1.8</a> <a class="post-tag" href="/tags/%E5%90%8E%E5%8F%B0/">后台</a> <a class="post-tag" href="/tags/vue/">vue</a> <a class="post-tag" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">多线程</a> <a class="post-tag" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a> <a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95/">算法</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://voidblank.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
